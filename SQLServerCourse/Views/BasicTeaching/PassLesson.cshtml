@using SQLServerCourse.Domain.Enum;

@model SQLServerCourse.Domain.ViewModels.Lesson.LessonPassViewModel

@{

    ViewData["Title"] = "Первая тема | №1";
}

@{
    string lessonContainerColor = "background: var(--color-blue)";
    if (Model.LessonType == LessonType.Exam)
    {
        lessonContainerColor = "background: var(--color-darkblue1)";
    }
}

<div class="container-fluid">
    <div class="container">
        <div class="row">
            <div class="col-12 lesson-container my-3" style=" @lessonContainerColor;">
                @if (Model.LessonType == LessonType.Exam)
                {
                    <h2 class="text-center text-white text-uppercase">Э к з а м е н</h2>
                }
                else
                {
                    <h2 class="text-center text-white">Практическая часть занятия</h2>
                }
                <div class="text-center">
                    @if ((Context.Request.Method == "POST") && (Model.LessonType == LessonType.Exam))
                    {
                        <a id="returnonlistoflessons" style="max-width: 275px; " class="btn btn-gradient btn-submit-answers my-4"
                       asp-controller="FinalResult" asp-action="GetFinalResult">Завершить экзамен</a>
                    }
                    @if ((Context.Request.Method == "POST") && (Model.LessonType != LessonType.Exam))
                    {
                        <a id="returnonlistoflessons" style="max-width: 275px; " class="btn btn-gradient btn-submit-answers"
                       asp-controller="PersonalProfile" asp-action="GetPersonalProfile">Выйти на список занятий</a>
                    }
                </div>
                <div class="tasks" align="justify">
                    <form autocomplete="off" asp-controller="BasicTeaching" asp-action="PassLesson">
                        <div>
                            <input type="hidden"
                                   asp-for="LessonId" value="@Model.LessonId" />
                                   
                        </div>
                        <h4 class="text-white mt-4" align="center">Начальный уровень</h4>
                        <br />
                        <div align="justify">
                            @for (int i = 0; i < Model.Questions.Count; i++)
                            {
                                <input type="hidden" asp-for="Questions[i].Number" value="@Model.Questions[i].Number" />
                                if (Model.Questions[i].QuestionType == TaskType.Open && Model.Questions[i - 1].QuestionType == TaskType.Test)
                                {
                                    <h4 class="text-white mt-3" align="center">Средний уровень</h4>
                                    <br />
                                }
                                <p><b>@Model.Questions[i].Number</b>. @Model.Questions[i].DisplayQuestion</p>
                                <div align="center" style="display: none;" class="answrunright my-3">Неправильно! Правильный ответ: @Model.Questions[i].RightPageAnswer</div>
                                <div align="center" style="display: none;" class="answrright my-3">Правильно!</div>
                                if (Model.Questions[i].QuestionType == TaskType.Test)
                                {
                                    for (int j = 1; j <= Model?.Questions[i]?.VariantsOfAnswer.Count; j++)
                                    {
                                        <input id="input-pointer-@j-@i" type="radio" asp-for="Questions[i].UserAnswer" value="v_@j" />
                                        <label for="input-pointer-@j-@i">@Model?.Questions[i]?.VariantsOfAnswer[j - 1].Content</label>
                                        <br />
                                    }
                                }
                                else
                                {
                                    <input class="form-control" style="border-radius:20px; max-width:275px;" type="text" asp-for="Questions[i].UserAnswer" placeholder="Ответ...">
                                }
                                <br />
                            }
                        </div>
                        @if (Context.Request.Method == "GET")
                        {
                            <button type="submit" id="sendanswers" class="btn btn-gradient btn-submit-answers mt-4">Завершить</button>
                        }
                    </form>
                    <div class="text-center">
                        @if ((Context.Request.Method == "POST") && (Model.LessonType == LessonType.Exam))
                        {
                            <a id="returnonlistoflessons" style="max-width: 275px; " class="btn btn-gradient btn-submit-answers my-4"
                           asp-controller="FinalResult" asp-action="GetFinalResult">Завершить экзамен</a>
                        }
                        @if ((Context.Request.Method == "POST") && (Model.LessonType != LessonType.Exam))
                        {
                            <a id="returnonlistoflessons" style="max-width: 275px; " class="btn btn-gradient btn-submit-answers"
                           asp-controller="PersonalProfile" asp-action="GetPersonalProfile">Выйти на список занятий</a>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@{
    @if (Context.Request.Method == "POST")
    {
        var taskCorrectness = new List<bool>();
        for (int i = 0; i < Model.Questions.Count; i++)
        {
            taskCorrectness.Add(Model.Questions[i].AnswerCorrectness);
        }

        <script>
            var taskCorrectness = @Json.Serialize(taskCorrectness);
            
            var unrightAnswers = document.getElementsByClassName('answrunright');
            var rightAnswers = document.getElementsByClassName('answrright');

            for (let i = 0; i < taskCorrectness.length; i++) {
                if (taskCorrectness[i]) {
                    setTimeout(function () {
                        rightAnswers[i].style.display = 'block';
                    }, 0);
                }
                else {
                    setTimeout(function () {
                        unrightAnswers[i].style.display = 'block';
                    }, 0);
                }
            }
        </script>
    }
}
